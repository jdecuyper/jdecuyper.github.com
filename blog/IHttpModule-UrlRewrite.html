<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <link href='https://fonts.googleapis.com/css?family=Chivo:900' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="../stylesheets/stylesheet.css" media="screen" />
    <link rel="stylesheet" type="text/css" href="../stylesheets/pygment_trac.css" media="screen" />
    <link rel="stylesheet" type="text/css" href="../stylesheets/print.css" media="print" />
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <title>jdecuyper.github.com by jdecuyper</title>
	
	<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-35502053-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

  </script>
	
  </head>

  <body>
    <div id="container">
      <div class="inner">

        <header>
          <h1>jdecuyper.github.com</h1>
          <h2>Blog entries</h2>
        </header>

        <section id="downloads" class="clearfix">
          <a href="index.html" class="button"><span><< Blog entries</span></a>
        </section>

        <hr>

		<h3>Use a IHttpModule to add a querystring parameter to all your aspx files</h3>
        <section id="main_content">
		
		<p>October 4, 2011</p>
		
		<p>Ever wondered how to append the same querystring to all your URL's? Let's say you want to have <strong>"?CurrentMode=Mode1.config"</strong> added to all your ASPX files and you don't want to do that manually
and be sure all links from your website include that configuration file? Well that can be done in .Net and surprisingly it is not a pain!</p>
		
		<p>The custom module looks as follow:</p>
		
<pre><code>using System;
using System.Collections.Generic;
using System.Linq;
using System.Web;

namespace MyModule
{
   public class RewriteModule : IHttpModule
   {
      public void Dispose()
      {
         throw new NotImplementedException();
      }

      public void Init(HttpApplication context)
      {
         context.BeginRequest += new EventHandler(OnBeginRequest);
      }

      public void OnBeginRequest(Object s, EventArgs e)
      {
         string url = HttpContext.Current.Request.Url.AbsolutePath;
         string cookie = String.Empty;
         if(urlLower.EndsWith(".aspx") {
            // Cookies are available at this point but no session values! 
            // you could start checking for cookies as follow: if(HttpContext.Current.Request.Cookies["CurrentMode"] != null) ...

           HttpContext.Current.RewritePath(url + "?PropertiesFile=module1.config");
         }
      }
    }
}
</code></pre>

	<p>Note that the parameter <strong>PropertiesFile</strong> will not be visible inside the browser's URL box but it will be available to the page (and to the code behind).</p>
	
	<p>Only drawback: no session object is available at this point in time, so your only salvation could be making use of some fresh cookies! <a href="http://stackoverflow.com/questions/12718413/access-to-session-variables-from-ihttpmodules-onbeginrequest-method" target="_blank" alt="The cookie trick">The cookie trick comes from stewartml@stackoverflow</a>.</p>
	
	<p>Lastly, you need to force your application to pick your module and that must be done referencing it through the web.config file:</p>
		<pre><code>&lt;system.web&gt;
   &lt;httpModules&gt;
      &lt;add name="RewriteModule" type="MyModule.RewriteModule" /&gt;
   &lt;/httpModules&gt;
&lt;/system.web&gt;
        </code></pre>
	
	<p>And to make the story complete, the specific application I was working on didn't support cookies and I ended up editing all those links manually, but I least I learned something new :)</p>


		</section>
       
        <footer>
          This page was generated by <a href="http://pages.github.com">GitHub Pages</a>. Tactile theme by <a href="http://twitter.com/jasonlong">Jason Long</a>.
        </footer>

        
      </div>
    </div>
  </body>
</html>